<!doctype html>
<html>
  <head>
    <title>Mon premier rendu 3D avec Three.js</title>
    <meta charset="utf-8">
    <link  href="css/main.css" rel="stylesheet"/>
  </head>
<body>
  <script src="lib/three.js"></script>
	<script src="lib/three.min.js"></script>
  <script src="lib/js/Mirror.js"></script>
	<script src="lib/js/controls/TrackballControls.js"></script>

		<script type="text/javascript">

      document.addEventListener('mousemove', onDocumentMouseMove, false);
      var container = document.createElement('div');
			document.body.appendChild(container);
      
			var renderer, scene, camera, roi1, roi2, roi3;
			var controls, carton;
      var mouseX = 20, mouseY = 50;
			var params = {opacity: 0.25};
			var WIDTH = window.innerWidth;
			var HEIGHT = window.innerHeight;
			init();
			animate();

			function init(){
				// on initialise la scène
				scene = new THREE.Scene();

				// on initialise la camera que l’on place ensuite sur la scène
				camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.set(0, 75, 310);
        scene.add(camera);
				//Création de la scène
				var groundMirror = new THREE.Mirror( 200, 200, { clipBias: 0.003, textureWidth: WIDTH, textureHeight: HEIGHT, color: 0x303030 } );
				groundMirror.rotateX( - Math.PI / 2 );
				scene.add( groundMirror );


        //Création d'un rectangle 3D pour repréenter le carton
				var geometry = new THREE.BoxGeometry( 13, 10, 2 );

				carton = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({color: 0x778899 }));

				carton.position.x = 20;
				carton.position.y = 50;
				carton.position.z = 20;

				carton.scale.x = 5;
				carton.scale.y = 4;
				carton.scale.z = 0.2;

				carton.castShadow = true;
				carton.receiveShadow = true;

				scene.add(carton);

				//Création des ROI
				geometry = new THREE.SphereBufferGeometry(20, 20, 20);
				var material1 = new THREE.MeshStandardMaterial( {
					opacity: params.opacity,
					//transparent: true,
					color: 0xffffff
				} );
				roi1 = new THREE.Mesh(geometry, material1);
				roi1.position.x = 20;
				roi1.position.y = 40;
				roi1.position.z = 43;
				scene.add(roi1);

				var material2 = new THREE.MeshStandardMaterial( {
					opacity: params.opacity,
					//transparent: true,
					color: 0xffffff
				} );
				roi2 = new THREE.Mesh(geometry, material1);
				roi2.position.x = 55;
				roi2.position.y = 70;
				roi1.position.z = 10;
				scene.add(roi2);

				var material3 = new THREE.MeshStandardMaterial( {
					opacity: params.opacity + 0.5,
					//transparent: true,
					color: 0xffffff
				} );
				roi3 = new THREE.Mesh(geometry, material1);
				roi3.position.x = -40;
				roi3.position.y = 70;
				roi3.position.z = -25;
				scene.add(roi3);



				//Création des guides

				var guideFront = new THREE.MeshBasicMaterial( {
					opacity: params.opacity + 0.5,
					transparent: true,
					color: 0xFF0000
				} );

				geometry = new THREE.CubeGeometry(200, 200, 200);


				var front1 = new THREE.Mesh(geometry, guideFront);
				front1.position.x = 200;
				front1.position.y = 100;

				var front2 = new THREE.Mesh(geometry, guideFront);
				front2.position.y = 100;
				front2.position.z = -	200;

				var front3 = new THREE.Mesh(geometry, guideFront);
				front3.position.x = -200;
				front3.position.y = 100;

				var front4 = new THREE.Mesh(geometry, guideFront);
				front4.position.y = 300;

				scene.add(front1);
				scene.add(front2);
				scene.add(front3);
				scene.add(front4);

				var front2 = new THREE.Mesh(geometry, guideFront);
				front2.position.x = -200;
				front2.position.y = 0;


				var spotLight = new THREE.SpotLight( 0x8888ff );
				spotLight.position.set( - 100, - 200, - 100 );
				spotLight.angle = Math.PI / 6;
				spotLight.penumbra = 0.9;
				scene.add( spotLight );

				renderer = new THREE.WebGLRenderer({antialias: true});
				renderer.setClearColor(0xf0f0f0);
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				renderer.sortObjects = false;

				renderer.shadowMap.enabled = true;
				renderer.shadowMap.type = THREE.PCFShadowMap;

				container.appendChild(renderer.domElement);
			}

			function animate(){

				// on fait tourner le cube sur ses axes x et y
				//mesh.rotation.x += 0.01;
				//mesh.rotation.y += 0.02;
				// on effectue le rendu de la scène
        carton.position.x = mouseX;
        carton.position.y = mouseY;
				renderer.render( scene, camera );


        // on appel la fonction animate() récursivement à chaque frame
				requestAnimationFrame( animate );
			}

			function onDocumentMouseMove(event){
        mouseX = event.clientX - canvas.left;
        mouseY = event.clientY - canvas.top;
			}
</script>


	<script type="text/javascript">

  </script>
</body>
</html>
